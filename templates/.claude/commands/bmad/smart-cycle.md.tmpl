---
description: Intelligent BMAD workflow routing for {{PROJECT_NAME}} ({{PROJECT_TYPE}}) - Analyzes requests and routes to optimal workflow.
allowed-tools: Bash(git:*), Bash(node:*), Bash(npm:*), Bash(powershell:*), Bash(pwsh:*), Bash({{TASKMASTER_CLI}}:*), Bash(npx task-master:*), Bash(pytest:*), Bash(docker:*), Bash(docker-compose:*), Read, Grep, Glob, Edit, Write, Task
---

# /bmad:smart-cycle

## INTELLIGENT WORKFLOW ORCHESTRATION

This command analyzes your request and routes it to the most appropriate BMAD workflow for optimal efficiency and results.

## 0) INFRASTRUCTURE CHECKS & ROUTING

**CRITICAL: Task Master Availability Check:**
```bash
# MUST succeed or workflow cannot proceed
./.claude/hooks/taskmaster-check.ps1 check
if ($LASTEXITCODE -ne 0) { 
    Write-Error "‚ùå BMAD requires Task Master AI. Install with: npm install -g task-master-ai"
    exit 1
}
```

**Docker Environment Check:**
```bash
# Ensure Docker is running (required for all development)
docker info > /dev/null 2>&1
if [ $? -ne 0 ]; then
    echo "‚ùå Docker is not running. Starting Docker Desktop..."
    # Attempt to start Docker Desktop (platform specific)
    if [[ "$OSTYPE" == "darwin"* ]]; then
        open -a Docker
    elif [[ "$OSTYPE" == "msys" ]] || [[ "$OSTYPE" == "win32" ]]; then
        Start-Process "C:\Program Files\Docker\Docker\Docker Desktop.exe"
    fi
    
    echo "‚è≥ Waiting for Docker to start (30 seconds)..."
    sleep 30
    
    docker info > /dev/null 2>&1
    if [ $? -ne 0 ]; then
        echo "‚ùå Docker failed to start. Please start Docker Desktop manually."
        exit 1
    fi
fi

# Start containers if not running
./.claude/hooks/docker-manager.ps1 status
if [ $? -ne 0 ]; then
    echo "üê≥ Starting Docker containers..."
    ./.claude/hooks/docker-manager.ps1 start
    
    # Wait for health checks
    echo "‚è≥ Waiting for services to be healthy..."
    sleep 5
    ./.claude/hooks/docker-manager.ps1 health
fi
```

**Task Master Project Initialization (First Time Only):**
```bash
# Check if Task Master is initialized for this project
if [ ! -d ".taskmaster" ]; then
    echo "üìã Task Master not initialized. Setting up now..."
    {{TASKMASTER_CLI}} init -y
    {{TASKMASTER_CLI}} models --set-main opus
    {{TASKMASTER_CLI}} models --set-fallback sonnet
    
    # Look for PRD or requirements to parse
    if [ -f "{{PRD_PATH}}" ]; then
        echo "Found PRD at {{PRD_PATH}}, parsing into tasks..."
        {{TASKMASTER_CLI}} parse-prd --input={{PRD_PATH}} --force
    elif [ -f "CLAUDE.md" ]; then
        echo "Found CLAUDE.md, parsing into tasks..."
        {{TASKMASTER_CLI}} parse-prd --input=CLAUDE.md --force
    elif [ -f "requirements.md" ]; then
        echo "Found requirements.md, parsing into tasks..."
        {{TASKMASTER_CLI}} parse-prd --input=requirements.md --force
    elif [ -f "README.md" ] && grep -q "Requirements\|Features\|Tasks" README.md; then
        echo "Found requirements in README.md, parsing into tasks..."
        {{TASKMASTER_CLI}} parse-prd --input=README.md --force
    else
        echo "No PRD found. Creating initial task from your request..."
        # Will create task from user input below
    fi
fi
```

**Task Context Loading:**
```bash
# Check if working on specific task or need to get next task
CURRENT_TASK=$({{TASKMASTER_CLI}} next --json)
if [[ -z "$CURRENT_TASK" ]]; then
    # Check if tasks exist at all
    TASK_COUNT=$({{TASKMASTER_CLI}} list --json | jq '. | length')
    
    if [[ "$TASK_COUNT" -eq 0 ]]; then
        echo "üìù No tasks exist yet. Initializing from your request..."
        # Orchestrator will handle initial task creation
    else
        echo "All tasks complete! Options:"
        echo "1. {{TASKMASTER_CLI}} parse-prd --input=<new-prd>"
        echo "2. Create new task from your request"
    fi
fi
```

**Load Orchestrator Agent:**
```
Load the orchestrator-agent with Task Master context to determine optimal workflow routing.
If no tasks exist, orchestrator will create initial tasks from user request.
```

**Initial Project Setup (First Time Only):**
```
For new projects or major initiatives:
1. GitHub Integration Check:
   - Check if GitHub remote configured
   - If not: Suggest running /bmad:github-setup
   - Auto-backup will be disabled until configured
   
2. Project Validation:
   - Load po-agent ‚Üí Use validate-project-setup capability
   - Auto-detect project type and characteristics
   - Validate against 6-section master checklist
   - If BLOCKED: Address critical setup issues first
   - Save validation: docs/validation/project-setup-[date].md
```

**Request Classification Process:**
1. **Analyze Request Characteristics**
   - Complexity and scope assessment
   - Requirements clarity evaluation  
   - Technical change impact analysis
   - Timeline and resource estimation

2. **Apply Classification Decision Tree**
   ```
   Is this a bug fix or small improvement? ‚Üí maintenance-cycle
   Clear requirements, no architecture changes? ‚Üí story-cycle/saas-cycle
   New project or major enhancement? ‚Üí greenfield/brownfield workflows
   Need business/UX/architecture planning? ‚Üí planning-cycle
   ```

3. **Route to Appropriate Workflow**
   - **Maintenance:** Simple fixes requiring minimal coordination
   - **Feature Development:** Standard story-based development
   - **Strategic Planning:** Multi-phase planning followed by development
   - **Project-Specific:** Specialized workflows for different project types

## WORKFLOW ROUTING OPTIONS

### Route A: Maintenance Cycle (`/bmad:maintenance-cycle`)
**When to Use:**
- Bug fixes and defect resolution
- Small improvements (< 4 hours)
- Configuration changes
- Documentation updates

**Process:** Developer ‚Üí QA Engineer ‚Üí Documentation ‚Üí Git

### Route B: Standard Development (`/bmad:story-cycle` or `/bmad:saas-cycle`)
**When to Use:**
- Clear feature requirements
- Moderate complexity (4-40 hours)
- No architectural changes
- Integration with existing systems

**Process:** Scrum Master ‚Üí Product Owner ‚Üí Developer ‚Üí QA Engineer ‚Üí Documentation ‚Üí Learnings ‚Üí Git

### Route C: Strategic Planning (`/bmad:planning-cycle`)
**When to Use:**
- Major features or capabilities
- Requirements unclear or need validation
- Architectural changes required
- Business/market research needed
- UX design required

**Process:** Planning Phase (Strategic Agents with Advanced Elicitation) ‚Üí Document Sharding ‚Üí Development Phase (Systematic Story Creation)

### Route D: Specialized Project Workflows
**When to Use:**
- New application development (`/bmad:greenfield-fullstack`)
- Existing system enhancement (`/bmad:brownfield-enhancement`) 
- Service/API development (`/bmad:service-development`)
- UI/Frontend development (`/bmad:ui-development`)

## ORCHESTRATOR DECISION QUESTIONS

The orchestrator will ask clarifying questions to ensure proper routing:

**Request Analysis:**
1. "Can you describe what you're trying to accomplish? Is this a bug fix, new feature, or major enhancement?"
2. "Do you have clear requirements, or do we need to research and plan the approach?"
3. "Will this require changes to the system architecture or technology stack?"
4. "Is this for an existing project or a new application?"

**Scope Assessment:**
- "Is this a small fix that could be completed in a few hours?"
- "Do you need market research, competitive analysis, or business validation?"
- "Will this require user experience design or major interface changes?"
- "Are there integrations with other systems or major technical decisions needed?"

**Timeline & Resources:**
- "What's your expected timeline for this work?"
- "How many people do you expect will be working on this?"
- "What's the complexity level - simple, moderate, or complex?"

## ORCHESTRATOR ROUTING LOGIC

### Classification Criteria

**Maintenance Route Triggers:**
- Keywords: "bug", "fix", "small improvement", "configuration", "update"
- Estimated effort: < 4 hours
- Clear scope with existing functionality
- No strategic planning needed

**Feature Development Route Triggers:**
- Keywords: "new feature", "add functionality", "integrate", "enhance"
- Estimated effort: 4-40 hours  
- Clear requirements available
- No major architectural changes

**Strategic Planning Route Triggers:**
- Keywords: "major", "new capability", "research", "architecture", "design"
- Estimated effort: > 40 hours or multi-week
- Requirements unclear or need validation
- Multiple stakeholders or complex coordination

**Project-Specific Route Triggers:**
- Keywords: "new application", "greenfield", "existing system", "brownfield"
- Project type identification needed
- Specialized workflow requirements

## POST-ROUTING EXECUTION

Once the orchestrator determines the optimal route:

1. **Communicate Routing Decision**
   - Explain why this route was selected
   - Set expectations for the workflow process
   - Identify key stakeholders and timeline

2. **Execute Selected Workflow**
   - Route to the appropriate `/bmad:*` command
   - Pass context and classification results
   - Monitor progress and adjust if needed

3. **Context Preservation**
   - Maintain request context across workflow phases
   - Ensure smooth handoffs between agents
   - Document decisions and rationale

## WORKFLOW MONITORING & ADJUSTMENT

**During Execution:**
- Monitor progress against expected timeline
- Identify when workflow adjustments are needed
- Escalate blockers or scope changes

**Change Management Integration:**
- **Requirement Changes**: Use change-checklist template for systematic analysis
- **Scope Evolution**: Apply change management process before major pivots  
- **Course Correction**: Load po-agent ‚Üí Use change management capability when needed
- **Impact Assessment**: Evaluate changes against epics, artifacts, and timelines
- Coordinate cross-workflow dependencies

**Quality Assurance:**
- Validate that selected workflow is appropriate
- Ensure all necessary agents are involved
- Confirm outputs meet quality standards
- Gather feedback for routing improvement

## SUCCESS METRICS

**Routing Accuracy:**
- Percentage of requests routed to optimal workflow on first attempt
- Reduction in workflow changes mid-process
- User satisfaction with workflow efficiency

**Time to Value:**
- Reduced time from request to first meaningful progress
- Faster completion for appropriately-scoped work
- Improved resource utilization across workflows

**Quality Outcomes:**
- Better alignment between request complexity and resources applied
- Reduced rework and scope creep
- Higher stakeholder satisfaction with results

## USAGE EXAMPLES

**Example 1: Bug Fix Request**
```
User: "There's a bug in the login form where validation errors don't show properly"
Orchestrator Analysis: Clear bug fix, existing functionality, < 4 hours
Routing Decision: `/bmad:maintenance-cycle`
```

**Example 2: New Feature Request**  
```
User: "Add a user profile page with avatar upload and account settings"
Orchestrator Analysis: New feature, clear scope, moderate complexity, ~16 hours
Routing Decision: `/bmad:story-cycle`
```

**Example 3: Strategic Initiative**
```
User: "We want to build a mobile app version of our web application"
Orchestrator Analysis: Major project, needs planning, architecture, UX design
Routing Decision: `/bmad:planning-cycle` ‚Üí `/bmad:greenfield-mobile`
```

Remember: The smart-cycle is your intelligent entry point into the BMAD system. Trust the orchestrator's analysis and routing decisions - they're designed to optimize your workflow efficiency and project success.